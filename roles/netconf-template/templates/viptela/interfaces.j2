<target>
  <candidate/>
</target>
<config>
  <vpn xmlns="http://viptela.com/vpn">
{% for vpn in vpn_instances|default([]) %}
    <vpn-instance>
      <vpn-id>{{ vpn.vpn_id }}</vpn-id>
        <interface operation="{{ netconf_operation }}">
{% for interface in vpn.interfaces %}
          <if-name>{{ interface.if_name }}</if-name>
{% if interface.ip is defined %}
            <ip>
{% if interface.ip.address is defined %}
              <address>{{ interface.ip.address }}</address>
{% elif interface.ip.dhcp_client is defined %}
              <dhcp-client>{{ 'true' if interface.ip.dhcp_client else 'false' }}</dhcp-client>
{% endif %}{# interface.ip.address #}
            </ip>
{% endif %}{# interface.ip #}
{% if interface.tunnel_interface is defined %}
            <tunnel-interface>
{% if interface.allow_service is defined %}
              <allow-service>
{% for service in interface.allow_service %}
                <{{ service }}>true</{{ service }}>
{% endfor %}{# service #}
              </allow-service>
{% endif %}{# interface.allow_service #}
            </tunnel-interface>
{% endif %}{# interface.tunnel_inteface #}
{% if interface.shutdown is defined %}
            <shutdown>{{ 'true' if interface.shutdown else 'false' }}</shutdown>
{% endif %}{# interface.shutdown #}
        </interface>
{% endfor %}{# vpn.interfaces #}
    </vpn-instance>
{% endfor %}{# vpn_instances #}
  </vpn>
</config>
